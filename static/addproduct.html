<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>添加商品</title>
</head>
<body>
  <h1>添加商品</h1>
  <form id="addForm">
    <label>名称: <input name="name" required /></label><br />
    <label>类别ID: <input name="category_id" required /></label><br />
    <label>描述: <input name="description" /></label><br />
    <label>价格: <input name="price" type="number" step="0.01" required /></label><br />
    <label>SKU: <input name="sku" required /></label><br />
    <label>库存: <input name="stock" type="number" required /></label><br />
    <label>封面图片 URL: <input name="cover_image" /></label><br />
    <label>图片列表(逗号分隔): <input name="images" /></label><br />
    <label>上架: <input name="is_on_sale" type="checkbox" checked /></label><br />
    <button type="submit">提交</button>
    <button type="button" id="cancel">取消</button>
    <button type="button" id="backToProducts" style="margin-left:8px">返回商品列表</button>
  </form>
  <pre id="result"></pre>
<script>
const form = document.getElementById('addForm');
const result = document.getElementById('result');
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(form).entries());
  const payload = {
    name: data.name,
    category_id: data.category_id,
    description: data.description || '',
    price: parseFloat(data.price) || 0,
    sku: data.sku,
    stock: parseInt(data.stock) || 0,
    cover_image: data.cover_image || '',
    images: data.images ? data.images.split(',').map(s=>s.trim()).filter(s=>s.length>0) : [],
    is_on_sale: !!form.is_on_sale.checked
  };
  try {
    const res = await fetch('/product/addproduct', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const ctype = res.headers.get('content-type') || '';
    if (ctype.includes('application/json')) {
      const j = await res.json();
      if (j.code === 200) {
        result.textContent = '添加成功，正在返回商品列表...';
        setTimeout(()=>{ window.location.href = '/static/products.html'; }, 800);
        return;
      }
      result.textContent = j.msg || JSON.stringify(j, null, 2);
    } else {
      const txt = await res.text();
      result.textContent = txt;
    }
  } catch (err) {
    result.textContent = '请求失败: ' + err.message;
  }
});

document.getElementById('cancel').addEventListener('click', ()=>{
  window.location.href = '/static/products.html';
});
document.getElementById('backToProducts').addEventListener('click', ()=>{
  window.location.href = '/static/products.html';
});
</script>
</body>
</html>